{% extends 'layouts/default.njk' %}

{% block metadata %}
<meta property="og:locale" content="de_DE" />
<meta property="og:type" content="article" />
<meta property="og:title" content="{{ title | e }} - Couchblog" />
{% set meta_description = page.excerpt or description or metadata.description %}
<meta property="og:description" content="{{ meta_description | trim | e }}" />
<meta property="og:url" content="{{ metadata.url }}{{ page.url }}" />
<meta property="og:site_name" content="Couchblog" />

{% if articleImage -%}
<meta property="og:image" content="{{ metadata.url }}/images/{{ articleImage.src }}" />
<meta property="og:image:width" content="{{ articleImage.width }}">
<meta property="og:image:height" content="{{ articleImage.height }}">
<link rel="image_src" href="{{ metadata.url }}/images/{{ articleImage.src }}">
{% elif headerImage -%}
<link rel="image_src" href="{{ metadata.url }}{{ page.url | imgPath }}{{ headerImage.src }}">
<meta property="og:image" content="{{ metadata.url }}{{ page.url | imgPath }}{{ headerImage.src }}" />
{% else -%}
<meta property="og:image" content="{{ metadata.url }}{{ metadata.author.image }}" />
<link rel="image_src" href="{{ metadata.url }}{{ metadata.author.image }}">
{% endif -%}

<meta name="last-modified" content="{{ page.date.toISOString() }}">
<meta name="date" content="{{ page.date.toISOString() }}">
<meta property="article:published_time" content="{{ page.date.toISOString() }}" />
<meta name="author" content="{{ metadata.author.name }}" />
<meta property="article:author" content="{{ metadata.url }}/about/">
<meta name="twitter:card" content="summary" />
{% endblock %}

{% block additional_styles %}
{%- css %}
{% include "node_modules/prismjs/themes/prism-okaidia.css" %}
{%- endcss %}
{% endblock %}


{% block main -%}
<article{% if language %} lang="{{ language }}"{%endif%} {% if (coverImage or articleImage or headerImage) and 'Geknipst' not in tags | filterTagList -%} class="featured"{%endif%}>
  {{ super() }}
</article>
{% endblock -%}

{%- block articleheader %}
<header class="articleheader">
  <h1>{{ title }}</h1>
  {% if date or tags -%}
    <div class="meta">
      {% if date %}
        <time datetime="{{ date }}">{{ date | longDate }}</time>
      {% endif %}
      {% if tags -%}
        {% set cue %}{% if tags | filterTagList | length > 1 %}Themen{% else %}Thema{% endif %}{% endset %}
        <span>{{ cue }}:
        {% for tag in tags | filterTagList -%}
          {% set tagUrl %}/category/{{ tag | slugify }}/{% endset -%}
          <a href="{{ tagUrl }}" class="post-tag">{{ tag }}</a>{% if not loop.last -%}
          {% if loop.index == loop.length -1 %} und {% else -%}, {% endif %}{% endif %}
        {% endfor -%}
      {% endif -%}
    </div>
  {% endif -%}
</header>
{%- endblock -%}

{%- block content %}
<div class="content">
  {{ super() }}
</div>
{% endblock %}

{% block featureimage -%}
  {% if coverImage or articleImage or headerImage -%}
    <figure class="feature-image">
      {% if coverImage or articleImage -%}
        {% set altText = articleImage.alt or title %}
        <img src="/images/{{ coverImage or articleImage.src }}" alt="{{ altText | e }}" />
      {% else -%}
        {% image headerImage.src, headerImage.alt, [400, 700, 1000], "(min-width: 1000px) 1000px, 100vw", "eager" %}
      {% endif -%}
    </figure>
  {% endif -%}
{% endblock -%}

{% block articlefooter -%}
{%- if collections.blog %}
{%- set nextPost = collections.blog | getNextCollectionItem(page) %}
{%- set previousPost = collections.blog | getPreviousCollectionItem(page) %}
{%- if nextPost or previousPost %}
<footer class="articlefooter">
{% if keywords or persons %}
<nav class="tags" aria-labelledby="tags-nav">
  <h2 id="tags-nav" class="visually-hidden">Links zu Stichworten dieses Artikels</h2>
  <ul>
    {% for person in persons %}
    <li><a href="/person/{{ person | slugify }}/">#{{ person }}</a></li>
    {% endfor %}
    {% for keyword in keywords %}
    <li><a href="/tag/{{ keyword | slugify }}/">#{{ keyword }}</a></li>
    {% endfor %}
  </ul>
</nav>
{% endif %}
<nav class="prevnext" aria-labelledby="pages-nav">
  <h2 id="pages-nav" class="visually-hidden">Links zu vorigen oder späteren Einträgen</h2>
  <ul>
  {%- if previousPost %}
    <li class="previous-post"><a href="{{ previousPost.url }}"><span class="visually-hidden">Voriger Eintrag: </span>{{ previousPost.data.title }}</a></li>
  {% endif %}
  {%- if nextPost %}
    <li class="next-post"><a href="{{ nextPost.url }}"><span class="visually-hidden">Nächster Eintrag: </span>{{ nextPost.data.title }}</a></li>
  {% endif %}
  </ul>
</footer>
{%- endif %}
{%- endif %}
{% endblock -%}

{% block commentsection -%}
{% if comments and commentsActive %}
<section id="comments__container" class="comments__container">
  <h2 id="comments__comment-count-title" class="comments__comments-title">
    {% if comments | length == 1 %}
      1 Kommentar
    {% else %}
      {{ comments | length }} Kommentare
    {% endif %}
  </h2>
  <div id="comments__comment-container" class="comments__comment-container">
    {% for comment in comments %}
    <article
      id="comments__comment-{{ comment.id }}"
      class="comments__comment{{ ' comments__comment-role-owner' if comment.email == metadata.author.email else '' }}"
    data-comment-id="{{ comment.id }}"
    data-author-name="{{ comment.createdBy | e }}"
    itemprop="comment" itemscope itemtype="https://schema.org/Comment">
      <div class="comments__comment-header">
        <div class="comments__author-information">
          <div class="comments__author-name-and-time">
            <h3 class="comments__author-name" itemprop="author" itemscope itemtype="https://schema.org/Person">
              <span itemprop="name">{{ comment.createdBy | e }}</span>
            </h3>
            <p class="comments__comment-time">
              <a href="#comments__comment-{{ comment.id }}" itemprop="url">
                <time datetime="{{ comment.date }}" itemprop="datePublished">
                  {{- comment.date | commentDate -}}
                </time>
              </a>
            </p>
          </div>
        </div>
      </div>
      <div itemprop="text" class="comments__comment-message">{{ comment.html | safe }}</div>
    </article>
    {% endfor %}
  </div>
</section>
{% endif %}
{% endblock -%}

{% block commentform -%}
{% if showComments and commentsActive %}
<div id="comments__form" class="comments__container">
  <h2 id="comments__form-title" class="comments__comments-title">Kommentieren</h2>
  <div id="comments__form-status" class="comments__form-status" role="status" aria-live="polite" aria-atomic="true"></div>
  <form
    class="comments__comment-form"
    id="commentsForm"
    name="post-comments"
    method="post"
    netlify
    netlify-honeypot="bot-field"
    aria-labelledby="comments__form-title"
  >
    <div class="comments__form-group">
      <label for="author-name">Name <sup aria-label="erforderlich">*</sup></label>
      <input type="text" id="author-name" name="name" required spellcheck="false" placeholder="Dein Name" autocomplete="name" aria-required="true">
    </div>
    <div class="comments__form-group">
      <label for="author-url">Website</label>
      <input type="url" id="author-url" name="website" placeholder="https://example.com" autocomplete="url">
    </div>
    <div class="comments__form-group">
      <label for="message">Kommentar <sup aria-label="erforderlich">*</sup></label>
      <textarea class="comments__comment-message" rows="10" name="comment" id="message" required spellcheck="true" placeholder="Hier zum Thema beitragen…" aria-required="true"></textarea>
    </div>
    <div hidden>
      <label>
        Dieses Feld leer lassen: <input name="bot-field" />
      </label>
    </div>
    <input type="hidden" name="articleTitle" value="{{ page.inputPath | articleFileName }}">
    <button type="submit" class="comments__submit-button" id="comments__submit-button">Kommentar absenden</button>
  </form>
</div>
<script src="/js/comment-form.js"></script>
{% endif %}
{% endblock -%}

{% block search %}{% endblock %}
